### 강의 노트

- 강의내용 정리

    회원가입은 로그인보다 쉬워요,.

    regester_view를 활용합시다.

    우리가 이미 받아놨던 유저 크리에이션 폼을 받고,

    여기에도 똑같이 랜더링해보고 진행해봅시다.

    def regester_view(request):

        form = UserCreationForm()

        return render(request, 'signup.html',{'form':form})

    그 다음에 utls.py에 연결합니다.

    path('register/', register_view, name = "signup")

    ...

    html template도 만들어줘야겠죠?

    <h1> Sign up! </h1>

    <form action="" method="post">

         {%csrf_token%}

         {{form.as_p}}

         <button type="submit"> submit</button>

    </form>

    (이런 느낌으로...)

- 서버 실행하려면 Migration 을 키자.

    ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/58dc8d15-3f91-4c0c-8d0e-452ac04018be/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/58dc8d15-3f91-4c0c-8d0e-452ac04018be/Untitled.png)

    ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8f18cfe9-744c-42b4-8908-74e8c368c1f8/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8f18cfe9-744c-42b4-8908-74e8c368c1f8/Untitled.png)

### 실습 코드

- view.py(account)

    ```python
    from django.shortcuts import redirect, render
    from django.contrib.auth.forms import AuthenticationForm
    from django.contrib.auth import authenticate,login,logout
    from .forms import RegisterForm
    # Create your views here.

    def login_view(request):
        if request.method == 'POST':
            form = AuthenticationForm(request=request,data = request.POST)
            if form.is_valid():
                username = form.cleaned_data.get("username")
                password = form.cleaned_data.get("password")
                user = authenticate(request=request, username=username, password=password)
                if user is not None:
                    login(request, user)
                
            return redirect("home")

        else:
            form = AuthenticationForm()
            return render(request, 'login.html', {'form':form})

    def logout_view(request):
        logout(request) #request를 logout auth에서 import하기만 하면 됨
        return redirect("home")

    def register_view(request):
        if request.method == "POST":
            form = RegisterForm(request.POST)
            if form.is_valid():
                user = form.save()
                login(request, user)
            return redirect("home")
        else:    
            form = RegisterForm()
            return render(request, 'signup.html',{'form':form})
    ```

- forms.py(account)

    ```python
    from django.contrib.auth.forms import UserCreationForm
    from .models import CustomUser

    class RegisterForm(UserCreationForm):
        class Meta:
            model = CustomUser
            fields = ['username','password1','password2','nickname','location','university']
    ```

- home.html(blog)

    ```html
    {% extends 'base.html'%}
    {% block content %}
         {% if user.is_authenticated %}
         {{user.location}}에 사는{{user.university}}다니는 {{user.nickname}}님 안녕하세요.

         {% endif %}
         <h1>Blog Project</h1>
         <div class = "container">
             {% for blog in blogs %}
             <div>
                 <h3>{{blog.title}}</h3>
                 {{blog.writer}}
                 {{blog.summary}} <a href="{% url 'detail' blog.id %}">...more</a>
                 <br>
             </div>
             {% endfor %}
         </div>

    {% endblock %}
    ```

- [models.py](http://models.py)(account)

    ```python
    from django.db import models
    from django.contrib.auth.models import AbstractUser

    # Create your models here.
    class CustomUser(AbstractUser):
        nickname = models.CharField(max_length=100)
        university = models.CharField(max_length=50)
        location = models.CharField(max_length=200)
    ```

- settings.py(lionproject)

    ```python
    """
    Django settings for lionproject project.

    Generated by 'django-admin startproject' using Django 3.2.4.

    For more information on this file, see
    https://docs.djangoproject.com/en/3.2/topics/settings/

    For the full list of settings and their values, see
    https://docs.djangoproject.com/en/3.2/ref/settings/
    """

    import os
    from pathlib import Path

    # Build paths inside the project like this: BASE_DIR / 'subdir'.
    BASE_DIR = Path(__file__).resolve().parent.parent

    # Quick-start development settings - unsuitable for production
    # See https://docs.djangoproject.com/en/3.2/howto/deployment/checklist/

    # SECURITY WARNING: keep the secret key used in production secret!
    SECRET_KEY = 'django-insecure-(&z4dq_cq@b-dm9k60^+vd0kypxjok9zq=p8rpnhc*el4j^b04'

    # SECURITY WARNING: don't run with debug turned on in production!
    DEBUG = True

    ALLOWED_HOSTS = []

    AUTH_USER_MODEL = 'account.CustomUser'

    # Application definition

    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'blog',
        'account',
    ]

    MIDDLEWARE = [
        'django.middleware.security.SecurityMiddleware',
        'django.contrib.sessions.middleware.SessionMiddleware',
        'django.middleware.common.CommonMiddleware',
        'django.middleware.csrf.CsrfViewMiddleware',
        'django.contrib.auth.middleware.AuthenticationMiddleware',
        'django.contrib.messages.middleware.MessageMiddleware',
        'django.middleware.clickjacking.XFrameOptionsMiddleware',
    ]

    ROOT_URLCONF = 'lionproject.urls'

    TEMPLATES = [
        {
            'BACKEND': 'django.template.backends.django.DjangoTemplates',
            'DIRS': ['lionproject/templates'],
            'APP_DIRS': True,
            'OPTIONS': {
                'context_processors': [
                    'django.template.context_processors.debug',
                    'django.template.context_processors.request',
                    'django.contrib.auth.context_processors.auth',
                    'django.contrib.messages.context_processors.messages',
                ],
            },
        },
    ]

    WSGI_APPLICATION = 'lionproject.wsgi.application'

    # Database
    # https://docs.djangoproject.com/en/3.2/ref/settings/#databases

    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': BASE_DIR / 'db.sqlite3',
        }
    }

    # Password validation
    # https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators

    AUTH_PASSWORD_VALIDATORS = [
        {
            'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
        },
        {
            'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
        },
        {
            'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
        },
        {
            'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
        },
    ]

    # Internationalization
    # https://docs.djangoproject.com/en/3.2/topics/i18n/

    LANGUAGE_CODE = 'en-us'

    TIME_ZONE = 'UTC'

    USE_I18N = True

    USE_L10N = True

    USE_TZ = True

    # Static files (CSS, JavaScript, Images)
    # https://docs.djangoproject.com/en/3.2/howto/static-files/

    STATIC_URL = '/static/'

    STATICFILES_DIRS = [
        os.path.join(BASE_DIR,'blog','static') ]

    #현재 static 파일들이 어디에 있는지
    STATIC_ROOT = os.path.join(BASE_DIR, 'static')
    #static 파일을 어디에 모을 건지.

    MEDIA_ROOT = os.path.join(BASE_DIR,'media')
    # 이용자가 업로드한 파일을 모으는 곳
    MEDIA_URL = '/media/'

    # Default primary key field type
    # https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field

    DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
    ```

- urls.py(lionproject)

    ```python
    """lionproject URL Configuration

    The `urlpatterns` list routes URLs to views. For more information please see:
        https://docs.djangoproject.com/en/3.2/topics/http/urls/
    Examples:
    Function views
        1. Add an import:  from my_app import views
        2. Add a URL to urlpatterns:  path('', views.home, name='home')
    Class-based views
        1. Add an import:  from other_app.views import Home
        2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
    Including another URLconf
        1. Import the include() function: from django.urls import include, path
        2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
    """
    from django.contrib import admin
    from django.urls import path,include
    from blog.views import home
    from django.conf import settings
    from django.conf.urls.static import static

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('', home, name="home"),
        path('blog/', include('blog.urls')),
        path('account/', include('account.urls')),
    ] + static(settings.MEDIA_URL, document_root = settings.MEDIA_ROOT)
    ```

- forms.py(blog)

    ```python
    from django import forms
    from django.forms import fields
    from .models import Blog

    class BlogForm(forms.ModelForm):
        class Meta:
            model = Blog
            fields = ['title','writer','body','image']
    ```

- urls.py(account)

    ```python
    from django.urls import path
    from .views import *

    urlpatterns = [
        path('login/', login_view, name="login"),
        path('logout/', logout_view, name="logout"),
        path('register/', register_view, name="signup"),
    ]
    ```

- login.html(account)

    ```html
    {% extends 'base.html'%}

    {%  block content %}

    <h1>Login</h1>

    <form action="{% url 'login' %}" method="post">
        {%csrf_token%}
        {{form.as_p}}
        <button type="submit">submit</button>
    </form>

    {% endblock %}
    ```

- signup.html(account)

    ```html
    {% extends 'base.html'%}

    {%  block content %}

    <h1>Sign Up!</h1>

    <form action="{% url 'signup' %}" method="post">
        {%csrf_token%}
        {{form.as_p}}
        <button type="submit">submit</button>
    </form>

    {% endblock %}
    ```

### SignUp한 회원 정보가 저장이 안되는 문제 발생

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5d88675c-2ec1-4199-a1f4-ed70c5acea3f/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5d88675c-2ec1-4199-a1f4-ed70c5acea3f/Untitled.png)

이 부분에서 submit을 하면 로그인이 된 상태로 home화면이 나와야하는데 그렇지 않아서 여기에 가입한 정보로 로그인을 해봤더니 계속 로그인이 되지 않는 상태로 나옴.

로그인 정보가 제대로 저장이 돼있는 Super User는 아래 실습 화면처럼 ~에 사는 ~다니는 ~님이라고 잘 뜬다. 혹시 저장이 안된건가? 싶어 admin db에 들어가봤더니 test용 회원가입한 유저 정보가 없었다. 현재 가입창에서 submit한 정보가 db로 넘어가지 않는 것 같다.

### 실습 화면

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7b4bdbbb-7e1b-44d5-89d6-0ea1467aa67e/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7b4bdbbb-7e1b-44d5-89d6-0ea1467aa67e/Untitled.png)

로그인 로그아웃, 가입기능까지 구현 완료

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/50bf32c4-90b9-4a35-8110-fc1d66f615e2/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/50bf32c4-90b9-4a35-8110-fc1d66f615e2/Untitled.png)

클릭하면 Sign Up창이 나온다.

Register에서 몇몇 요소를 더 수정해주고 나면

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5d88675c-2ec1-4199-a1f4-ed70c5acea3f/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5d88675c-2ec1-4199-a1f4-ed70c5acea3f/Untitled.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2fc285ae-4192-4e4c-9df1-1654117310ea/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2fc285ae-4192-4e4c-9df1-1654117310ea/Untitled.png)

Nickname, Location, University 정보를 적을 수 있는 로그인 화면이 뜬다.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5b91bd83-45fc-4c52-a39d-7221b031380d/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5b91bd83-45fc-4c52-a39d-7221b031380d/Untitled.png)

이제 로그인 정보를 관리해보자.
